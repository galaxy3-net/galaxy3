#!/bin/bash

cat <<__EOD__

  Installing XRDP

__EOD__

     apt-get install -yq -o Dpkg::Options::='--force-confold' --force-yes xrdp xorgxrdp-hwe-18.04 xfce4 xfce4-goodies xfonts-100dpi xfonts-75dpi xfonts-traditional \
     xfonts-terminus-dos xfonts-mona xfonts-efont-unicode 2>&1 >>/var/log/install.log

     mkdir -p /home/vagrant/.vnc

     cat <<__EOD__ > /home/vagrant/.vnc/xstartup
#!/bin/bash
xrdb /home/vagrant/.Xresources
startxfce4 &
__EOD__



     chown -R vagrant:vagrant /home/vagrant/.vnc/
     chmod u+x /home/vagrant/.vnc/xstartup

     adduser xrdp ssl-cert
     adduser xrdp tty

cat <<__EOD__ > /etc/X11/Xwrapper.config
# Xwrapper.config (Debian X Window System server wrapper configuration file)
#
# This file was generated by the post-installation script of the
# xserver-xorg-legacy package using values from the debconf database.
#
# See the Xwrapper.config(5) manual page for more information.
#
# This file is automatically updated on upgrades of the xserver-xorg-legacy
# package *only* if it has not been modified since the last upgrade of that
# package.
#
# If you have edited this file but would like it to be automatically updated
# again, run the following command as root:
#   dpkg-reconfigure xserver-xorg-legacy
allowed_users=anybody
needs_root_rights=no
__EOD__

#systemctl enable xrdp
#systemctl start xrdp
#systemctl status xrdp

cat <<__EOD__ >/etc/init.d/turn_off_iptables
#!/bin/bash
     iptables -F
     iptables -X
     iptables -P INPUT ACCEPT
     iptables -P OUTPUT ACCEPT
     iptables -P FORWARD ACCEPT
__EOD__

ln -s /etc/init.d/turn_off_iptables /etc/rc3.d/S99iptables

#  References
#
#  https://www.digitalocean.com/community/tutorials/how-to-install-and-configure-vnc-on-ubuntu-16-04

