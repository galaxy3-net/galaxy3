#!/usr/bin/env bash
set -x

function clone () {
  cd ${G3HOME}/spicerack && git clone eggs:galaxy3-net/eggs.git
}

function fetch_eggs () {
  ls ${G3HOME}/spicerack/eggs || clone
  fetch_the_golden_egg
  cd ${G3HOME}/spicerack/eggs && git pull
}

function fetch_the_golden_egg () {

  #  Leave if we already have the golden egg.
  ls ${G3HOME}/spicerack/.ssh/egg && return

  # Fetch the golden egg.
  echo 'Fetch the Golden Egg'
  mkdir -p ${G3HOME}/spicerack/.ssh/
  chmod 0700 ${G3HOME}/spicerack/.ssh
  ls -dl ${G3HOME}/egg && cp ${G3HOME}/egg ${G3HOME}/spicerack/.ssh/.
  ls -dl /vagrant/egg && cp /vagrant/egg ${G3HOME}/spicerack/.ssh/.
  chmod 0700 ${G3HOME}/spicerack/.ssh/egg
}

get_spicerack
fetch_eggs
